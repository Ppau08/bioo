<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Malla Bioquímica Interactiva</title>
  <script type="module" src="firebase-config.js"></script>
  <style>
    body {
      font-family: serif;
      background: url('LLL.png') no-repeat center center fixed;
      background-size: cover;
      color: #1c0312;
    }

    h1 {
      text-align: center;
      margin-bottom: 40px;
      font-size: 22px;
    }

    .container {
      display: flex;
      justify-content: center;
      overflow-x: auto;
    }

    .year-column {
      width: 240px;
      margin: 0 10px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      align-items: stretch;
      font-size: 16px;
    }

    .year-column h2 {
      text-align: center;
      color: #fff;
      background-color: #821D59;
      margin: 0;
      padding: 10px;
      border-radius: 15px;
      font-size: 20px;
    }

    .divider {
      height: 2px;
      background-color: #000;
      margin: 20px 0;
    }

    .cuatrimestre {
      min-height: 280px;
    }

    .materia {
      background-color: #FFFFFF;
      border: 2px solid #fff;
      border-radius: 8px;
      margin: 8px 0;
      padding: 10px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s;
    }

    .materia.estado-1 {
      background-color: #E2EAC2;
    }

    .materia.estado-2 {
      background-color: #A7AF80;
      text-decoration: line-through;
      color: #1c0312;
    }

    .botones {
      text-align: center;
      margin: 20px;
    }

    button {
      padding: 10px 15px;
      margin: 5px;
      border-radius: 8px;
      border: none;
      background-color: #821D59;
      color: white;
      font-size: 16px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Malla Bioquímica - Plan 2009</h1>
  <div class="botones">
    <button onclick="guardarProgreso()">Guardar Progreso</button>
    <button onclick="cargarProgreso()">Cargar Progreso</button>
  </div>
  <div class="container" id="malla"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, getDoc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCHebE8dyfWeG54scQinhS_Sn2kg73GctU",
      authDomain: "malla-interactiva-bioqui.firebaseapp.com",
      projectId: "malla-interactiva-bioqui",
      storageBucket: "malla-interactiva-bioqui.appspot.com",
      messagingSenderId: "927818756347",
      appId: "1:927818756347:web:33470cba743179fc97c05e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const materias = [
      [
        ["Álgebra y Geometría Analítica", "Química General"],
        ["Cálculo Diferencial e Integral", "Química Inorgánica", "Biología General y Celular"]
      ],
      [
        ["Mecánica, Calor y Termodinámica", "Química Orgánica I", "Morfología"],
        ["Electricidad, Magnetismo, Óptica y Sonido", "Química Orgánica II", "Química Analítica"]
      ],
      [
        ["Química Biológica I", "Química Física Biológica", "Bioestadística"],
        ["Química Biológica II", "Genética y Biología Molecular", "Química Analítica Instrumental"]
      ],
      [
        ["Virología Clínica", "Microbiología General", "Fisiología Humana", "Farmacología"],
        ["Bromatología y Nutrición", "Fisiopatología", "Inmunología Clínica", "Parasitología Humana"]
      ],
      [
        ["Bacteriología y Micología Clínica", "Química Clínica", "Toxicología y Química Legal", "Ética Profesional"],
        ["Endocrinología y Monitoreo de Drogas Terapéuticas", "Optativa I", "Gestión de Laboratorio", "Epistemología e Investigación"]
      ],
      [
        ["Práctica Hospitalaria"],
        ["Práctica Optativa"]
      ]
    ];

    const mallaDiv = document.getElementById("malla");

    materias.forEach((anio, idx) => {
      const col = document.createElement("div");
      col.className = "year-column";

      const titulo = document.createElement("h2");
      titulo.textContent = `${idx + 1}° Año`;
      col.appendChild(titulo);

      anio.forEach((cuatri, i) => {
        if (i === 1) col.appendChild(document.createElement("div")).className = "divider";

        cuatri.forEach(nombre => {
          const mat = document.createElement("div");
          mat.className = "materia";
          mat.textContent = nombre;
          mat.onclick = () => {
            mat.classList.toggle("estado-1");
            if (!mat.classList.contains("estado-1")) {
              mat.classList.remove("estado-2");
            } else if (mat.classList.contains("estado-1") && !mat.classList.contains("estado-2")) {
              mat.classList.add("estado-2");
            }
          };
          col.appendChild(mat);
        });
      });

      mallaDiv.appendChild(col);
    });

    async function guardarProgreso() {
      const estados = {};
      document.querySelectorAll(".materia").forEach(el => {
        estados[el.textContent] = el.className;
      });
      await setDoc(doc(db, "progresos", "usuario1"), estados);
      alert("Progreso guardado");
    }

    async function cargarProgreso() {
      const docSnap = await getDoc(doc(db, "progresos", "usuario1"));
      if (docSnap.exists()) {
        const estados = docSnap.data();
        document.querySelectorAll(".materia").forEach(el => {
          el.className = estados[el.textContent] || "materia";
        });
      } else {
        alert("No se encontró progreso guardado");
      }
    }
  </script>
</body>
</html>
